import{_ as ne,x as E,y as $,z as k,A as W,J as V,K as de,L as G,M as j,N as w,k as fe,g as L,O as ie,o as me,P as _e,Q as J,R as we,S as ce,D as ge,T as Ce,U as Pe,B as U}from"./BYti2pCf.js";const Re={class:"header"},xe={class:"header-info"},Ae={class:"tick-counter"},Oe={class:"speed-controls"},Be=["onClick"],Ie={__name:"HeaderBar",props:{state:Object,onReset:Function,tickSpeed:Number,onSetSpeed:Function,onManualTick:Function},setup(e){const t=e,o=[{label:"1x",ms:5e3},{label:"2x",ms:2500},{label:"5x",ms:1e3},{label:"10x",ms:500}];function f(r){return t.tickSpeed===r}return(r,v)=>(E(),$("header",Re,[k("h1",null,W(e.state?e.state.name:"Life Support"),1),k("div",xe,[k("span",Ae,"T"+W(e.state?e.state.tickCount:0),1),k("div",Oe,[(E(),$(V,null,de(o,i=>k("button",{key:i.ms,class:G(["btn","btn-speed",{active:f(i.ms)}]),onClick:l=>e.onSetSpeed(i.ms)},W(i.label),11,Be)),64)),k("button",{class:"btn btn-next",onClick:v[0]||(v[0]=(...i)=>e.onManualTick&&e.onManualTick(...i)),title:"Advance one tick"},"Next")]),k("span",{class:G(["status-badge",e.state&&e.state.alive?"alive":"dead"])},W(e.state&&e.state.alive?"Online":"Collapsed"),3),k("button",{class:"btn btn-danger",onClick:v[1]||(v[1]=(...i)=>e.onReset&&e.onReset(...i))},"Reset")])]))}},Ee=ne(Ie,[["__scopeId","data-v-6835d7c6"]]),se=18,te=se*2,Z=se*Math.sqrt(3),le=te*.75,K=Z,ae=["energy","food","water","minerals"],ye={energy:"#d97706",food:"#16a34a",water:"#2563eb",minerals:"#ea580c"},$e={class:"resources-strip"},We={class:"label"},He={class:"resource-val-row"},Ne={__name:"ResourcePanel",props:{state:Object,deltas:Object,history:Array},setup(e){const t=e,o=L({});let f={};const r={};function v(s,d){d&&(r[s]=d)}j(()=>t.state&&t.state.resources,s=>{if(s)for(const d of ae){const a=s[d]||0;f[d]!==void 0&&f[d]!==a&&(o.value={...o.value,[d]:!0},setTimeout(()=>{o.value={...o.value,[d]:!1}},500)),f[d]=a}},{deep:!0});function i(){const s=t.history;if(!(!s||s.length<2))for(const d of ae){const a=r[d];if(!a)continue;const c=a.getContext("2d"),p=window.devicePixelRatio||1,y=a.clientWidth,b=a.clientHeight;a.width=y*p,a.height=b*p,c.scale(p,p),c.clearRect(0,0,y,b);const g=s.slice(-20);let h=1/0,S=-1/0;for(const P of g){const R=P[d]||0;R<h&&(h=R),R>S&&(S=R)}S===h&&(S=h+1),c.strokeStyle=ye[d],c.lineWidth=1.5,c.lineJoin="round",c.lineCap="round",c.beginPath();for(let P=0;P<g.length;P++){const R=P/(g.length-1)*y,x=b-((g[P][d]||0)-h)/(S-h)*b;P===0?c.moveTo(R,x):c.lineTo(R,x)}c.stroke()}}j(()=>t.history&&t.history.length,()=>{ie(i)});const l=fe(()=>ae.map(s=>{const d=t.state&&t.state.resources&&t.state.resources[s]||0,a=t.deltas&&t.deltas[s]||0;return{key:s,val:d,delta:a}}));function n(s){return!!o.value[s]}return(s,d)=>(E(),$("div",$e,[(E(!0),$(V,null,de(w(l),a=>(E(),$("div",{key:a.key,class:G(["resource-card",a.key])},[k("div",We,W(a.key),1),k("div",He,[k("span",{class:G(["value",{flashing:n(a.key)}])},W(a.val),3),k("span",{class:G(["delta-pill",a.delta>0?"positive":a.delta<0?"negative":"neutral"])},W(a.delta>0?"+":"")+W(a.delta)+"/t ",3)]),k("canvas",{ref_for:!0,ref:c=>v(a.key,c),class:"sparkline-canvas"},null,512)],2))),128))]))}},De=ne(Ne,[["__scopeId","data-v-cdf85b76"]]),Le={class:"pop-row"},Xe={class:"pop-value"},ze={__name:"PopulationBar",props:{state:Object},setup(e){return(t,o)=>(E(),$("div",Le,[o[0]||(o[0]=k("span",{class:"pop-label"},"Colonists",-1)),k("span",Xe,W(e.state?e.state.population:0)+" / "+W(e.state?e.state.populationCapacity:0),1)]))}},Ye=ne(ze,[["__scopeId","data-v-87081975"]]);function Me(e,t){return(e&1)===0?[[e+1,t-1],[e+1,t],[e,t+1],[e-1,t],[e-1,t-1],[e,t-1]]:[[e+1,t],[e+1,t+1],[e,t+1],[e-1,t+1],[e-1,t],[e,t-1]]}function be(e,t){const o=e,f=t-(e-(e&1))/2,r=-o-f;return{x:o,y:r,z:f}}function ke(e,t,o,f){const r=be(e,t),v=be(o,f);return Math.max(Math.abs(r.x-v.x),Math.abs(r.y-v.y),Math.abs(r.z-v.z))}function je(e,t,o,f,r){const v=[];for(let i=Math.max(0,e-o-1);i<=Math.min(f-1,e+o+1);i++)for(let l=Math.max(0,t-o-1);l<=Math.min(r-1,t+o+1);l++)ke(e,t,i,l)<=o&&v.push([i,l]);return v}function Fe(e){return function(){e|=0,e=e+1831565813|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Ge={SOLAR_PANEL:{fill:"#f59e0b",accent:"#fbbf24"},HYDROPONIC_FARM:{fill:"#22c55e",accent:"#4ade80"},WATER_EXTRACTOR:{fill:"#3b82f6",accent:"#60a5fa"},MINE:{fill:"#f97316",accent:"#fb923c"},HABITAT:{fill:"#94a3b8",accent:"#cbd5e1"}};let re=null,ue=null;function ve(e,t,o,f){const r=e/f,v=t/f,i=Math.floor(r),l=Math.floor(v),n=r-i,s=v-l,d=n*n*(3-2*n),a=s*s*(3-2*s);function c(P,R){let x=P*374761393+R*668265263+o|0;return x=(x^x>>13)*1274126177,((x^x>>16)&2147483647)/2147483647}const p=c(i,l),y=c(i+1,l),b=c(i,l+1),g=c(i+1,l+1),h=p+(y-p)*d,S=b+(g-b)*d;return h+(S-h)*a}function qe(e,t){if(re&&re.w===e&&re.h===t)return re.data;const o=new Array(e*t);for(let f=0;f<t;f++)for(let r=0;r<e;r++){const v=ve(r,f,42,6),i=ve(r,f,137,3),l=ve(r,f,251,1.2),n=v*.5+i*.3+l*.2,s=28+(i-.5)*10,d=30+(v-.5)*15,a=58+(n-.5)*18;o[f*e+r]="hsl("+s.toFixed(0)+","+d.toFixed(0)+"%,"+a.toFixed(0)+"%)"}return re={w:e,h:t,data:o},o}function Ze(e,t){if(ue&&ue.w===e&&ue.h===t)return ue.data;const o=[];for(let f=0;f<e*t;f++){const r=Math.random();if(r<.08)o.push({type:"rock_large",ox:Math.random()*.4+.1,oy:Math.random()*.4+.1,size:.2+Math.random()*.15,color:"#9e8a6a"});else if(r<.22){const v=[],i=1+Math.floor(Math.random()*3);for(let l=0;l<i;l++)v.push({ox:Math.random()*.7+.1,oy:Math.random()*.7+.1,size:.04+Math.random()*.06});o.push({type:"pebbles",pebbles:v,color:"#a08e70"})}else r<.28?o.push({type:"crater",ox:.25+Math.random()*.3,oy:.25+Math.random()*.3,size:.15+Math.random()*.15}):o.push(null)}return ue={w:e,h:t,data:o},o}function Q(e,t,o){return e*le*t+te/2*t+o}function ee(e,t,o,f){return t*K*o+(e&1)*(K/2)*o+Z/2*o+f}function oe(e,t,o,f){e.beginPath();for(let r=0;r<6;r++){const v=Math.PI/180*(60*r),i=t+f*Math.cos(v),l=o+f*Math.sin(v);r===0?e.moveTo(i,l):e.lineTo(i,l)}e.closePath()}function Ue(e,t,o,f,r){if(!t)return;const v=r*.6;switch(t.type){case"rock_large":{const i=o+(t.ox-.5)*v*2,l=f+(t.oy-.5)*v*2,n=t.size*r;e.fillStyle=t.color,e.beginPath(),e.moveTo(i,l-n*.3),e.lineTo(i+n*.5,l-n*.1),e.lineTo(i+n*.4,l+n*.3),e.lineTo(i-n*.3,l+n*.35),e.lineTo(i-n*.45,l),e.closePath(),e.fill(),e.strokeStyle="#b8a080",e.lineWidth=.5,e.stroke();break}case"pebbles":{e.fillStyle=t.color;for(const i of t.pebbles){const l=o+(i.ox-.5)*v*2,n=f+(i.oy-.5)*v*2,s=i.size*r;e.beginPath(),e.arc(l,n,s,0,Math.PI*2),e.fill()}break}case"crater":{const i=o+(t.ox-.5)*v*2,l=f+(t.oy-.5)*v*2,n=t.size*r;e.strokeStyle="rgba(120, 100, 70, 0.4)",e.lineWidth=.8,e.beginPath(),e.arc(i,l,n,0,Math.PI*2),e.stroke(),e.fillStyle="rgba(0, 0, 0, 0.05)",e.beginPath(),e.arc(i+n*.1,l+n*.1,n*.7,0,Math.PI*2),e.fill();break}}}function pe(e,t,o,f,r,v){const i=Ge[t]||{fill:"#888",accent:"#aaa"};e.globalAlpha=v;const l=o+r/2,n=f+r/2,s=r*.4;switch(t){case"SOLAR_PANEL":{const d=s*1.8,a=s*1.1;e.fillStyle=i.fill,e.fillRect(l-d/2,n-a/2,d,a),e.strokeStyle=i.accent,e.lineWidth=.8;for(let p=1;p<3;p++){const y=l-d/2+d/3*p;e.beginPath(),e.moveTo(y,n-a/2),e.lineTo(y,n+a/2),e.stroke()}const c=n;e.beginPath(),e.moveTo(l-d/2,c),e.lineTo(l+d/2,c),e.stroke(),e.fillStyle=i.accent,e.beginPath(),e.arc(l+d/2-s*.3,n-a/2-s*.2,s*.18,0,Math.PI*2),e.fill();break}case"HYDROPONIC_FARM":{e.fillStyle=i.fill,e.beginPath(),e.ellipse(l,n,s*1.1,s*.75,0,0,Math.PI*2),e.fill(),e.strokeStyle=i.accent,e.lineWidth=1.2,e.beginPath(),e.arc(l,n+s*.1,s*.6,Math.PI*1.1,Math.PI*1.9),e.stroke(),e.fillStyle=i.accent,e.beginPath(),e.moveTo(l,n-s*.35),e.quadraticCurveTo(l+s*.4,n-s*.1,l,n+s*.25),e.quadraticCurveTo(l-s*.4,n-s*.1,l,n-s*.35),e.fill();break}case"WATER_EXTRACTOR":{e.strokeStyle=i.fill,e.lineWidth=1.2,e.beginPath(),e.arc(l,n,s,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(l,n,s*.65,0,Math.PI*2),e.stroke(),e.fillStyle=i.accent,e.beginPath(),e.moveTo(l,n-s*.35),e.quadraticCurveTo(l+s*.25,n,l,n+s*.3),e.quadraticCurveTo(l-s*.25,n,l,n-s*.35),e.fill();break}case"MINE":{e.fillStyle=i.fill,e.beginPath(),e.moveTo(l,n-s),e.lineTo(l+s*.8,n),e.lineTo(l,n+s),e.lineTo(l-s*.8,n),e.closePath(),e.fill(),e.strokeStyle=i.accent,e.lineWidth=1.5,e.beginPath(),e.moveTo(l-s*.35,n-s*.35),e.lineTo(l+s*.35,n+s*.35),e.moveTo(l+s*.35,n-s*.35),e.lineTo(l-s*.1,n+s*.1),e.stroke();break}case"HABITAT":{const d=s*1.4,a=s*.45;e.fillStyle=i.fill,e.fillRect(l-d/2,n,d,a),e.beginPath(),e.arc(l,n,s*.7,Math.PI,0),e.fill(),e.strokeStyle=i.accent,e.lineWidth=1,e.beginPath(),e.arc(l,n-s*.1,s*.25,Math.PI*1.2,Math.PI*1.8),e.stroke(),e.fillStyle=i.accent,e.fillRect(l-s*.1,n,s*.2,a*.8);break}default:e.fillStyle=i.fill,e.fillRect(o+r*.15,f+r*.15,r*.7,r*.7)}e.globalAlpha=1}const Je={__name:"GameMap",props:{camera:Object,interaction:Object,state:Object,gridWidth:Number,gridHeight:Number,onTileClick:Function,revealedTiles:Object},setup(e){const t=e,o=L(null);let f=null,r=!0,v=0;const i=[];function l(){r=!0}j(()=>t.state,()=>{if(t.state&&t.state.placedBuildings){const d=t.state.placedBuildings.length;if(d>v){for(let a=v;a<d;a++){const c=t.state.placedBuildings[a];i.push({x:c.x,y:c.y,start:performance.now(),duration:600})}v=d}}l()},{deep:!0}),j(()=>t.interaction.hoverTile.value,l),j(()=>t.interaction.selectedBuilding.value,l),j(()=>t.camera.offsetX.value,l),j(()=>t.camera.offsetY.value,l),j(()=>t.camera.zoom.value,l),j(()=>t.revealedTiles,l),j(()=>[t.gridWidth,t.gridHeight],()=>{const d=o.value;d&&t.gridWidth&&t.gridHeight&&(t.camera.centerOn(d.clientWidth,d.clientHeight),l())});function n(){f=requestAnimationFrame(n);const d=performance.now();let a=!1;for(let M=i.length-1;M>=0;M--)d-i[M].start>i[M].duration?i.splice(M,1):a=!0;if(a&&(r=!0),!r)return;r=!1;const c=o.value;if(!c)return;const p=c.getContext("2d"),y=t.camera,b=t.gridWidth||32,g=t.gridHeight||32,h=y.zoom.value,S=y.offsetX.value,P=y.offsetY.value,R=se*h,x=window.devicePixelRatio||1,X=c.clientWidth,O=c.clientHeight;c.width!==X*x||c.height!==O*x?(c.width=X*x,c.height=O*x,p.scale(x,x)):p.setTransform(x,0,0,x,0,0),p.fillStyle="#1a1510",p.fillRect(0,0,X,O);const _=Math.max(0,Math.floor((-S-te*h)/(le*h))),m=Math.min(b-1,Math.ceil((X-S+te*h)/(le*h))),u=Math.max(0,Math.floor((-P-Z*h)/(K*h))),T=Math.min(g-1,Math.ceil((O-P+Z*h)/(K*h))),B=qe(b,g),D=Ze(b,g),A=t.revealedTiles;for(let M=u;M<=T;M++)for(let C=_;C<=m;C++){if(A&&!A.has(C+","+M))continue;const z=Q(C,h,S),N=ee(C,M,h,P);p.fillStyle=B[M*b+C],oe(p,z,N,R),p.fill()}for(let M=u;M<=T;M++)for(let C=_;C<=m;C++){if(A&&!A.has(C+","+M))continue;const z=D[M*b+C];if(z){const N=Q(C,h,S),Y=ee(C,M,h,P);Ue(p,z,N,Y,R)}}if(A&&A.size>0)for(let M=u;M<=T;M++)for(let C=_;C<=m;C++){if(A.has(C+","+M))continue;const z=Me(C,M);let N=!1;for(const[Y,F]of z)if(Y>=0&&Y<b&&F>=0&&F<g&&A.has(Y+","+F)){N=!0;break}if(N){const Y=Q(C,h,S),F=ee(C,M,h,P);p.fillStyle="rgba(30, 24, 15, 0.55)",oe(p,Y,F,R),p.fill()}}p.strokeStyle="rgba(139, 92, 42, 0.2)",p.lineWidth=.5;for(let M=u;M<=T;M++)for(let C=_;C<=m;C++){if(A&&!A.has(C+","+M))continue;const z=Q(C,h,S),N=ee(C,M,h,P);oe(p,z,N,R),p.stroke()}const H=new Set;t.state&&t.state.placedBuildings&&t.state.placedBuildings.forEach(M=>{H.add(M.x+","+M.y)}),t.state&&t.state.placedBuildings&&t.state.placedBuildings.forEach(M=>{if(M.x>=_&&M.x<=m&&M.y>=u&&M.y<=T){const C=Q(M.x,h,S),z=ee(M.x,M.y,h,P),N=Z*h;pe(p,M.type,C-N/2,z-N/2,N,1)}});for(const M of i)if(M.x>=_&&M.x<=m&&M.y>=u&&M.y<=T){const C=(d-M.start)/M.duration,z=Q(M.x,h,S),N=ee(M.x,M.y,h,P),Y=.6*(1-C),F=C*R*.3;p.strokeStyle="rgba(255,255,255,"+Y+")",p.lineWidth=2,oe(p,z,N,R+F),p.stroke()}const I=t.interaction.hoverTile.value;if(I&&I.gx>=_&&I.gx<=m&&I.gy>=u&&I.gy<=T&&(!A||A.has(I.gx+","+I.gy))){const M=Q(I.gx,h,S),C=ee(I.gx,I.gy,h,P);p.fillStyle="rgba(255, 255, 255, 0.3)",oe(p,M,C,R),p.fill()}const q=t.interaction.selectedBuilding.value;if(q&&I&&I.gx>=0&&I.gx<b&&I.gy>=0&&I.gy<g&&(!A||A.has(I.gx+","+I.gy))){const M=Q(I.gx,h,S),C=ee(I.gx,I.gy,h,P),z=H.has(I.gx+","+I.gy);z?p.fillStyle="rgba(239, 68, 68, 0.3)":p.fillStyle="rgba(34, 197, 94, 0.15)",oe(p,M,C,R),p.fill();const N=Z*h;pe(p,q,M-N/2,C-N/2,N,z?.3:.6)}}function s(){r=!0}return me(()=>{const d=o.value;d&&(t.camera.centerOn(d.clientWidth,d.clientHeight),r=!0),window.addEventListener("resize",s),f=requestAnimationFrame(n)}),_e(()=>{window.removeEventListener("resize",s),f&&cancelAnimationFrame(f)}),(d,a)=>(E(),$("canvas",{ref_key:"canvasRef",ref:o,class:"game-canvas",onMousedown:a[0]||(a[0]=J(c=>e.interaction.onPointerDown(w(o),c),["prevent"])),onMousemove:a[1]||(a[1]=J(c=>e.interaction.onPointerMove(w(o),c),["prevent"])),onMouseup:a[2]||(a[2]=J(c=>e.interaction.onPointerUp(w(o),c,e.onTileClick),["prevent"])),onMouseleave:a[3]||(a[3]=J(c=>e.interaction.onPointerUp(w(o),c,null),["prevent"])),onWheel:a[4]||(a[4]=J(c=>e.interaction.onWheel(w(o),c),["prevent"])),onTouchstart:a[5]||(a[5]=J(c=>e.interaction.onPointerDown(w(o),c),["prevent"])),onTouchmove:a[6]||(a[6]=J(c=>e.interaction.onPointerMove(w(o),c),["prevent"])),onTouchend:a[7]||(a[7]=J(c=>e.interaction.onPointerUp(w(o),c,e.onTileClick),["prevent"]))},null,544))}},Ve=ne(Je,[["__scopeId","data-v-03ac522a"]]),Ke={class:"build-panel"},Qe={class:"build-cards"},et=["onClick"],tt={class:"b-card-header"},nt={class:"b-card-title"},ot={class:"b-name"},st={class:"b-desc"},lt={class:"b-stats"},at={class:"b-cost-label"},it={class:"b-cost-bar-track"},ct={class:"b-stat-line prod-val"},rt={class:"b-stat-line cons-val"},ut={class:"b-card-footer"},dt={class:"b-owned"},ft={__name:"BuildPanel",props:{buildings:Array,state:Object,selectedBuilding:String,canAfford:Function},emits:["select"],setup(e,{emit:t}){const o=e,f=t,r={};function v(y,b){b&&(r[y]=b)}function i(){if(o.buildings)for(const y of o.buildings){const b=r[y.id];if(!b)continue;const g=b.getContext("2d"),h=window.devicePixelRatio||1;b.width=44*h,b.height=44*h,g.scale(h,h),g.fillStyle="#c2a67d",g.fillRect(0,0,44,44),pe(g,y.id,2,2,40,1)}}me(()=>{ie(i)}),j(()=>o.buildings,()=>{ie(i)},{deep:!0});function l(y){if(!y)return"";const b=[];for(const g in y)b.push(y[g]+" "+g);return b.join(", ")}function n(y){return y?Object.keys(y).length>0:!1}function s(y){return!o.state||!o.state.buildings?0:o.state.buildings[y.toLowerCase()]||0}function d(y){return!o.state||!o.state.resources?0:o.state.resources[y]||0}function a(y){if(!y||!o.state||!o.state.resources)return"";let b="",g=0;for(const h in y){const S=o.state.resources[h]||0,P=y[h]-S;P>g&&(g=P,b=h)}return g>0?g+" "+b:""}function c(y,b){const g=d(y);return Math.min(100,g/b*100)}function p(y){f("select",y)}return(y,b)=>(E(),$("div",Ke,[b[3]||(b[3]=k("div",{class:"build-panel-title"},"Buildings",-1)),k("div",Qe,[(E(!0),$(V,null,de(e.buildings,g=>(E(),$("div",{key:g.id,class:G(["building-card",{selected:e.selectedBuilding===g.id},e.canAfford(g.cost)?"affordable":"unaffordable"]),onClick:h=>p(g.id)},[k("div",tt,[k("canvas",{ref_for:!0,ref:h=>v(g.id,h),class:"b-thumb-canvas",width:"44",height:"44"},null,512),k("div",nt,[k("div",ot,W(g.name),1),k("div",st,W(g.description),1)])]),k("div",lt,[b[2]||(b[2]=k("div",{class:"b-stats-label"},"Cost",-1)),(E(!0),$(V,null,de(g.cost,(h,S)=>(E(),$("div",{key:S,class:"b-cost-row"},[k("span",at,W(S),1),k("div",it,[k("div",{class:G(["b-cost-bar-fill",S]),style:we({width:c(S,h)+"%"})},null,6)]),k("span",{class:G(["b-cost-amount",d(S)>=h?"b-cost-met":"b-cost-unmet"])},W(d(S))+"/"+W(h),3)]))),128)),n(g.produces)?(E(),$(V,{key:0},[b[0]||(b[0]=k("div",{class:"b-stats-label prod"},"Produces",-1)),k("div",ct,"+"+W(l(g.produces))+"/tick",1)],64)):ce("",!0),n(g.consumes)?(E(),$(V,{key:1},[b[1]||(b[1]=k("div",{class:"b-stats-label cons"},"Consumes",-1)),k("div",rt,"-"+W(l(g.consumes))+"/tick",1)],64)):ce("",!0)]),k("div",ut,[k("span",dt,"x"+W(s(g.id)),1),k("div",{class:G(["b-afford-badge",e.canAfford(g.cost)?"ready":"blocked"])},[e.canAfford(g.cost)?(E(),$(V,{key:0},[ge("READY")],64)):(E(),$(V,{key:1},[ge("NEED: "+W(a(g.cost)),1)],64))],2)])],10,et))),128))])]))}},ht=ne(ft,[["__scopeId","data-v-7b4d29df"]]),vt={class:"event-log-section"},gt={key:0,class:"log-tick"},yt={class:"log-msg"},pt={key:0,class:"log-entry normal"},mt={__name:"EventLog",props:{log:Array},setup(e){const t=e,o=L(null);return j(()=>t.log.length,()=>{ie(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)})}),(f,r)=>(E(),$("div",vt,[r[1]||(r[1]=k("div",{class:"build-panel-title"},"Event Log",-1)),k("div",{class:"event-log",ref_key:"logEl",ref:o},[(E(!0),$(V,null,de(e.log,v=>(E(),$("div",{key:v.id,class:G(["log-entry",v.severity])},[v.tick!=null?(E(),$("span",gt,"[T"+W(v.tick)+"]",1)):ce("",!0),k("span",yt,W(v.msg),1)],2))),128)),e.log.length?ce("",!0):(E(),$("div",pt,[...r[0]||(r[0]=[k("span",{class:"log-msg"},"Awaiting colony data...",-1)])]))],512)]))}},bt=ne(mt,[["__scopeId","data-v-11c7f6dd"]]),Mt={class:"graph-modal-header"},kt={__name:"ResourceGraph",props:{history:Array,expanded:Boolean},emits:["toggle"],setup(e,{emit:t}){const o=e,f=t,r=L(null);function v(l){if(l<=0)return{yMax:10,step:5};const n=l*1.15,s=Math.pow(10,Math.floor(Math.log10(n))),d=n/s;let a;d<=1.5?a=1.5*s:d<=2?a=2*s:d<=3?a=3*s:d<=5?a=5*s:d<=7.5?a=7.5*s:a=10*s;const c=a/5;return{yMax:a,step:Math.max(1,Math.round(c))}}function i(){const l=r.value;!l||!o.expanded||ie(()=>{const n=l.getContext("2d"),s=window.devicePixelRatio||1,d=l.clientWidth,a=l.clientHeight;l.width=d*s,l.height=a*s,n.scale(s,s),n.fillStyle="#f7f4ef",n.fillRect(0,0,d,a);const c=o.history||[];if(c.length<2){n.fillStyle="#8a7e6b",n.font='11px "Courier New", monospace',n.textAlign="center",n.fillText("Waiting for data...",d/2,a/2);return}let p=0;for(let m=0;m<c.length;m++)for(const u of ae){const T=c[m][u]||0;T>p&&(p=T)}const{yMax:y,step:b}=v(p),g=32,h=8,S=8,P=18,R=d-g-h,x=a-S-P;n.strokeStyle="rgba(0,0,0,0.07)",n.lineWidth=.5,n.font='9px "Courier New", monospace',n.fillStyle="#8a7e6b",n.textAlign="right";for(let m=b;m<y;m+=b){const u=S+x-m/y*x;n.beginPath(),n.moveTo(g,u),n.lineTo(d-h,u),n.stroke(),n.fillText(Math.round(m),g-4,u+3)}const X=S+x;n.beginPath(),n.moveTo(g,X),n.lineTo(d-h,X),n.stroke(),n.fillText("0",g-4,X+3),n.textAlign="center",n.fillStyle="#8a7e6b";const O=Math.max(1,Math.floor(c.length/6));for(let m=0;m<c.length;m+=O){const u=g+m/(c.length-1)*R;n.fillText("T"+c[m].tick,u,a-3)}if(c.length>1){const m=g+R;n.fillText("T"+c[c.length-1].tick,m,a-3)}n.lineWidth=1.5,n.lineJoin="round",n.lineCap="round";for(const m of ae){n.strokeStyle=ye[m],n.beginPath();for(let u=0;u<c.length;u++){const T=g+u/(c.length-1)*R,B=Math.max(0,Math.min(y,c[u][m]||0)),D=S+x-B/y*x;u===0?n.moveTo(T,D):n.lineTo(T,D)}n.stroke()}const _=c.length-1;for(const m of ae){const u=g+R,T=Math.max(0,Math.min(y,c[_][m]||0)),B=S+x-T/y*x;n.fillStyle=ye[m],n.beginPath(),n.arc(u,B,3,0,Math.PI*2),n.fill()}})}return j(()=>o.history&&o.history.length,i),j(()=>o.expanded,l=>{l&&ie(i)}),(l,n)=>(E(),Ce(Pe,{to:"body"},[e.expanded?(E(),$("div",{key:0,class:"graph-modal-backdrop",onClick:n[2]||(n[2]=s=>f("toggle"))},[k("div",{class:"graph-modal",onClick:n[1]||(n[1]=J(()=>{},["stop"]))},[k("div",Mt,[n[3]||(n[3]=k("span",null,"Resource Analytics",-1)),k("button",{class:"btn",onClick:n[0]||(n[0]=s=>f("toggle"))},"Close")]),k("canvas",{ref_key:"graphCanvas",ref:r,class:"resource-graph-canvas"},null,512),n[4]||(n[4]=k("div",{class:"graph-legend"},[k("span",{class:"legend-item energy"},"Energy"),k("span",{class:"legend-item food"},"Food"),k("span",{class:"legend-item water"},"Water"),k("span",{class:"legend-item minerals"},"Minerals")],-1))])])):ce("",!0)]))}},St=ne(kt,[["__scopeId","data-v-bb010603"]]);function Tt(e){const t="/colony",o=L(null),f=L(null),r=L([]),v=L([]),i=L([]),l=60,n=L(!1);let s=null;const d=L(new Set);function a(u,T){const B=Math.floor(u/2),D=Math.floor(T/2),A=Fe(42),H=new Set,I=180,q=[[B,D]],M=new Set;for(M.add(B+","+D),H.add(B+","+D);q.length>0&&H.size<I;){const[C,z]=q.shift(),N=Me(C,z);for(const[Y,F]of N){const he=Y+","+F;if(Y<0||Y>=u||F<0||F>=T||M.has(he))continue;M.add(he);const Se=ke(B,D,Y,F),Te=Math.max(.25,.95-Se*.065);A()<Te&&(H.add(he),q.push([Y,F]))}}d.value=H}function c(u,T,B){const D=x.value,A=X.value,H=je(u,T,B,D,A),I=new Set(d.value);for(const[q,M]of H)I.add(q+","+M);d.value=I}async function p(){try{const[u,T]=await Promise.all([fetch(`${t}/config`),fetch(t)]);f.value=await u.json(),o.value=await T.json(),r.value=f.value.buildings||[],h(o.value),S(0,"Colony connection established."),a(f.value.gridWidth||32,f.value.gridHeight||32),y()}catch{S(null,"Failed to connect to colony server.")}}function y(){s&&(s.close(),s=null),s=new EventSource(`${t}/events`),n.value=!0,s.onmessage=function(u){try{const T=JSON.parse(u.data);T.colonyState&&(o.value=T.colonyState,h(T.colonyState)),T.events&&S(T.tick,T.events)}catch{}},s.onerror=function(){n.value=!1,S(null,"SSE connection lost. Retrying...")}}async function b(u,T,B){try{const A=await(await fetch(`${t}/build/${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({x:T,y:B})})).json();return A.colonyState&&(o.value=A.colonyState),S(o.value?o.value.tickCount:null,A.message),A}catch{return S(null,"Build request failed."),{success:!1,message:"Network error"}}}async function g(){try{const u=await fetch(`${t}/reset`,{method:"POST"});o.value=await u.json(),v.value=[],i.value=[],h(o.value),S(0,"Colony has been reset.");const T=f.value?f.value.gridWidth:32,B=f.value?f.value.gridHeight:32;a(T,B),y()}catch{S(null,"Reset failed.")}}function h(u){!u||!u.resources||(i.value.push({tick:u.tickCount||0,energy:u.resources.energy||0,food:u.resources.food||0,water:u.resources.water||0,minerals:u.resources.minerals||0}),i.value.length>l&&(i.value=i.value.slice(-l)))}function S(u,T){let B="normal";/COLLAPSED|DEAD/i.test(T)?B="collapse":/WARNING|shortage/i.test(T)&&(B="warning"),v.value.push({tick:u,msg:T,severity:B,id:Date.now()+Math.random()}),v.value.length>200&&(v.value=v.value.slice(-200))}function P(u){if(!u||!o.value||!o.value.resources)return!1;for(const T in u)if((o.value.resources[T]||0)<u[T])return!1;return!0}const R=fe(()=>{const u={energy:0,food:0,water:0,minerals:0};if(!o.value||!r.value)return u;r.value.forEach(B=>{const D=B.id.toLowerCase(),A=o.value.buildings&&o.value.buildings[D]||0;if(A>0){for(const H in B.produces)u[H]=(u[H]||0)+B.produces[H]*A;for(const H in B.consumes)u[H]=(u[H]||0)-B.consumes[H]*A}});const T=o.value.population||0;return u.food-=Math.floor(T/2),u.water-=Math.floor(T/3),u}),x=fe(()=>f.value?f.value.gridWidth:32),X=fe(()=>f.value?f.value.gridHeight:32),O=L(5e3);async function _(){try{await fetch(`${t}/tick`,{method:"POST"})}catch{S(null,"Manual tick failed.")}}async function m(u){try{const B=await(await fetch(`${t}/speed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({intervalMs:u})})).json();O.value=B.intervalMs}catch{S(null,"Speed change failed.")}}return{state:o,buildingsInfo:r,eventLog:v,gridWidth:x,gridHeight:X,resourceDeltas:R,resourceHistory:i,revealedTiles:d,tickSpeed:O,init:p,buildAt:b,resetColony:g,canAfford:P,revealAround:c,manualTick:_,setSpeed:m}}function _t(e,t){const r=L(0),v=L(0),i=L(1);function l(c,p){const y=e.value||32,b=t.value||32,g=i.value,h=Math.floor(y/2),S=Math.floor(b/2),P=h*le+te/2,R=S*K+(h&1)*(K/2)+Z/2;r.value=c/2-P*g,v.value=p/2-R*g}function n(c,p){const y=i.value,b=c*le*y+te/2*y+r.value,g=p*K*y+(c&1)*(K/2)*y+Z/2*y+v.value;return{sx:b,sy:g}}function s(c,p){const y=i.value,b=(c-r.value)/y-te/2,g=(p-v.value)/y-Z/2,h=2/3*b/se,S=(-1/3*b+Math.sqrt(3)/3*g)/se,P=-h-S;let R=Math.round(h),x=Math.round(S),X=Math.round(P);const O=Math.abs(R-h),_=Math.abs(x-S),m=Math.abs(X-P);O>_&&O>m?R=-x-X:_>m&&(x=-R-X);const u=R,T=x+Math.floor((R-(R&1))/2);return{gx:u,gy:T}}function d(c,p){r.value+=c,v.value+=p}function a(c,p,y){const b=i.value,g=y>0?.9:1.1;i.value=Math.max(.5,Math.min(2,i.value*g));const h=i.value/b;r.value=c-(c-r.value)*h,v.value=p-(p-v.value)*h}return{offsetX:r,offsetY:v,zoom:i,centerOn:l,screenToGrid:s,gridToScreen:n,pan:d,zoomAt:a,HEX_SIZE:se,HEX_W:te,HEX_H:Z,HORIZ:le,VERT:K,MIN_ZOOM:.5,MAX_ZOOM:2}}function wt(e,t,o){const f=L(null),r=L(null),v=10;let i=!1,l=0,n=0,s=0,d=0,a=!1,c=0,p=1;function y(O,_){const m=O.getBoundingClientRect(),u=_.touches?_.touches[0]:_;return u?{x:u.clientX-m.left,y:u.clientY-m.top}:{x:0,y:0}}function b(O){if(O.touches.length<2)return 0;const _=O.touches[0].clientX-O.touches[1].clientX,m=O.touches[0].clientY-O.touches[1].clientY;return Math.sqrt(_*_+m*m)}function g(O,_){const m=O.getBoundingClientRect(),u=(_.touches[0].clientX+_.touches[1].clientX)/2,T=(_.touches[0].clientY+_.touches[1].clientY)/2;return{x:u-m.left,y:T-m.top}}function h(O,_){if(_.touches&&_.touches.length===2){c=b(_),p=e.zoom.value;return}const m=y(O,_);i=!0,a=!1,l=m.x,n=m.y,s=m.x,d=m.y}function S(O,_){const m=y(O,_);if(_.touches&&_.touches.length===2){const D=b(_);if(c>0){const A=g(O,_),H=p*(D/c),I=Math.max(e.MIN_ZOOM,Math.min(e.MAX_ZOOM,H)),q=I/e.zoom.value;e.zoom.value=I,e.offsetX.value=A.x-(A.x-e.offsetX.value)*q,e.offsetY.value=A.y-(A.y-e.offsetY.value)*q}return}const u=e.screenToGrid(m.x,m.y),T=t.value||32,B=o.value||32;if(u.gx>=0&&u.gx<T&&u.gy>=0&&u.gy<B?f.value={gx:u.gx,gy:u.gy}:f.value=null,i){const D=m.x-s,A=m.y-d,H=m.x-l,I=m.y-n;!a&&(Math.abs(H)>v||Math.abs(I)>v)&&(a=!0),a&&e.pan(D,A),s=m.x,d=m.y}}function P(O,_,m){if(_.touches&&_.touches.length<2&&(c=0),!!i){if(i=!1,!a){const u=e.screenToGrid(l,n),T=t.value||32,B=o.value||32;u.gx>=0&&u.gx<T&&u.gy>=0&&u.gy<B&&m&&m(u.gx,u.gy)}a=!1}}function R(O,_){_.preventDefault();const m=y(O,_);e.zoomAt(m.x,m.y,_.deltaY)}function x(O){r.value=O}function X(){r.value=null}return{hoverTile:f,selectedBuilding:r,onPointerDown:h,onPointerMove:S,onPointerUp:P,onWheel:R,selectBuilding:x,clearSelection:X}}const Ct={class:"app-layout"},Pt={class:"resource-strip-wrapper"},Rt={class:"map-fullscreen"},xt={key:0,class:"build-hint"},At={class:"sidebar desktop-sidebar"},Ot={class:"mobile-controls"},Bt={__name:"index",setup(e){const t=Tt(),o=_t(t.gridWidth,t.gridHeight),f=wt(o,t.gridWidth,t.gridHeight),r=L(!1),v=L(!1);async function i(d,a){const c=f.selectedBuilding.value;if(!c||!t.state.value||!t.state.value.alive||!t.revealedTiles.value.has(d+","+a))return;const p=t.buildingsInfo.value.find(b=>b.id===c);if(!p||!t.canAfford(p.cost))return;const y=await t.buildAt(c,d,a);y&&y.success!==!1&&t.revealAround(d,a,3)}function l(d){f.selectedBuilding.value===d?f.clearSelection():f.selectBuilding(d)}function n(){r.value=!r.value}function s(){v.value=!v.value}return me(()=>{t.init()}),(d,a)=>{const c=Ee,p=De,y=Ye,b=Ve,g=ht,h=bt,S=St;return E(),$("div",Ct,[U(c,{state:w(t).state.value,"on-reset":w(t).resetColony,"tick-speed":w(t).tickSpeed.value,"on-set-speed":w(t).setSpeed,"on-manual-tick":w(t).manualTick},null,8,["state","on-reset","tick-speed","on-set-speed","on-manual-tick"]),k("div",Pt,[U(p,{state:w(t).state.value,deltas:w(t).resourceDeltas.value,history:w(t).resourceHistory.value},null,8,["state","deltas","history"]),U(y,{state:w(t).state.value},null,8,["state"]),k("button",{class:"btn graph-toggle-btn",onClick:s},"Analytics")]),k("div",Rt,[U(b,{camera:w(o),interaction:w(f),state:w(t).state.value,"grid-width":w(t).gridWidth.value,"grid-height":w(t).gridHeight.value,"on-tile-click":i,"revealed-tiles":w(t).revealedTiles.value},null,8,["camera","interaction","state","grid-width","grid-height","revealed-tiles"]),w(f).selectedBuilding.value?(E(),$("div",xt,[ge(" Click on the map to place "+W(w(f).selectedBuilding.value.replace(/_/g," "))+" ",1),k("button",{class:"btn btn-cancel",onClick:a[0]||(a[0]=P=>w(f).clearSelection())},"Cancel")])):ce("",!0)]),k("div",At,[U(g,{buildings:w(t).buildingsInfo.value,state:w(t).state.value,"selected-building":w(f).selectedBuilding.value,"can-afford":w(t).canAfford,onSelect:l},null,8,["buildings","state","selected-building","can-afford"]),U(h,{log:w(t).eventLog.value},null,8,["log"])]),U(S,{history:w(t).resourceHistory.value,expanded:w(v),onToggle:s},null,8,["history","expanded"]),k("div",Ot,[k("button",{class:"btn mobile-build-btn",onClick:n},W(w(r)?"Close":"Build"),1)]),k("div",{class:G(["mobile-sheet",{open:w(r)}])},[a[2]||(a[2]=k("div",{class:"mobile-sheet-tabs"},[k("button",{class:G(["tab-btn",{active:!0}])},"Buildings")],-1)),U(g,{buildings:w(t).buildingsInfo.value,state:w(t).state.value,"selected-building":w(f).selectedBuilding.value,"can-afford":w(t).canAfford,onSelect:a[1]||(a[1]=P=>{l(P),r.value=!1})},null,8,["buildings","state","selected-building","can-afford"]),U(h,{log:w(t).eventLog.value},null,8,["log"])],2)])}}},Et=ne(Bt,[["__scopeId","data-v-430654f8"]]);export{Et as default};
